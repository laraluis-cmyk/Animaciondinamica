<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Juego Pixel Art ‚Äì San Valent√≠n</title>

<style>
html, body {
margin: 0;
padding: 0;
background: #2b0f1a;
color: #fff;
font-family: 'Courier New', monospace;
height: 100%;
}

#game {
width: 640px;
height: 360px;
margin: 40px auto;
background: linear-gradient(#3a1022, #1b0b14);
border: 6px solid #000;
image-rendering: pixelated;
position: relative;
overflow: hidden;
}

.center {
display: flex;
justify-content: center;
align-items: center;
flex-direction: column;
height: 100%;
text-align: center;
}

button {
margin-top: 12px;
padding: 10px 18px;
background: #ff4d6d;
border: 3px solid #000;
color: #fff;
font-family: inherit;
cursor: pointer;
}

.hearts {
position: absolute;
top: 8px;
right: 8px;
font-size: 20px;
color: #ffb3c6;
}

.question {
position: absolute;
top: 16px;
width: 100%;
text-align: center;
font-size: 16px;
color: #ffd6e0;
}

.options {
display: flex;
justify-content: center;
gap: 24px;
margin-top: 90px;
}

.cube {
width: 90px;
height: 90px;
background: #ff758f;
border: 4px solid #000;
display: flex;
justify-content: center;
align-items: center;
text-align: center;
padding: 6px;
font-size: 12px;
color: #000;
transition: background 0.2s;
}

.cube.hit {
background: #fff0f5;
}

canvas {
position: absolute;
width: 96px;
height: 96px;
}
</style>
</head>

<body>
<div id="game">
  <div class="hearts" id="hearts"></div>
  <canvas id="raccoon" width="96" height="96"></canvas>
  <div id="screen"></div>
</div>

<script>
const screen = document.getElementById('screen');
const heartsUI = document.getElementById('hearts');
const raccoonCanvas = document.getElementById('raccoon');

let hearts = 3;
let level = 0;
let canCollide = false;
let collisionCooldown = false;

let raccoon = { x: 16, y: 240, speed: 4 };
let keys = {};

document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function drawHearts() {
  heartsUI.textContent = '‚ù§'.repeat(hearts);
}

function resetRaccoon() {
  raccoon.x = 16;
  raccoon.y = 240;
}

function resetGame() {
  hearts = 3;
  level = 0;
  drawHearts();
  resetRaccoon();
  startScreen();
}

function loseHeart(all = false) {
  hearts = all ? 0 : hearts - 1;
  if (hearts <= 0) resetGame();
  drawHearts();
}

function startScreen() {
  canCollide = false;
  screen.innerHTML = `
  <div class="center">
    <h2>üíñ Empezar üíñ</h2>
    <button onclick="nextLevel()">Comenzar</button>
  </div>`;
}

function nextLevel() {
  level++;
  canCollide = false;
  collisionCooldown = false;
  resetRaccoon();

  setTimeout(() => {
    if (level === 1) levelOne();
    else if (level === 2) levelTwo();
    else if (level === 3) levelThree();
    else if (level === 4) finalQuestion();
    else if (level === 5) winScreen();
  }, 100);
}

function levelTemplate(question, options, correct) {
  screen.innerHTML = `
  <div class="question">${question}</div>
  <div class="options">
    ${options.map((o, i) =>
      `<div class="cube" data-i="${i}" data-c="${correct}">${o}</div>`
    ).join('')}
  </div>`;
  canCollide = true;
}

function levelOne() {
  levelTemplate('¬øCu√°l es mi color favorito?', ['Rojo', 'Verde', 'Azul'], 1);
}

function levelTwo() {
  levelTemplate('¬øAnimal favorito?', ['Lagartija', 'Le√≥n', 'Perro'], 0);
}

function levelThree() {
  levelTemplate('¬øC√≥mo nos conocimos?', [
    'Llegu√© y me arrastr√© para pedirte salir',
    'Me viste en Instagram',
    'EPICCCCC'
  ], 2);
}

function finalQuestion() {
  screen.innerHTML = `
  <div class="question">¬øTe gustar√≠a ser mi San Valent√≠n?</div>
  <div class="options">
    <div class="cube" data-win="1">S√≠ üíò</div>
    <div class="cube" data-lose="1">No üíî</div>
    <div class="cube" data-win="1">Te tardaste üò≥</div>
  </div>`;
  canCollide = true;
}

function winScreen() {
  canCollide = false;
  screen.innerHTML = `
  <div class="center">
    <h2>üíñ Te veo el s√°bado üíñ<br>v√≠stete bonito :)</h2>
    <button onclick="resetGame()">Volver a jugar</button>
  </div>`;
}

/* === COLISIONES CORRECTAS === */
function checkCollision() {
  if (!canCollide || collisionCooldown) return;

  document.querySelectorAll('.cube').forEach(cube => {
    const a = raccoonCanvas.getBoundingClientRect();
    const b = cube.getBoundingClientRect();

    if (
      a.left < b.right &&
      a.right > b.left &&
      a.top < b.bottom &&
      a.bottom > b.top
    ) {
      collisionCooldown = true;
      cube.classList.add('hit');

      setTimeout(() => {
        if (cube.dataset.win) nextLevel();
        else if (cube.dataset.lose) loseHeart(true);
        else {
          Number(cube.dataset.i) === Number(cube.dataset.c)
            ? nextLevel()
            : loseHeart();
        }
        collisionCooldown = false;
      }, 300);
    }
  });
}

/* === GAME LOOP === */
function gameLoop() {
  if (keys['a']) raccoon.x -= raccoon.speed;
  if (keys['d']) raccoon.x += raccoon.speed;
  if (keys['w']) raccoon.y -= raccoon.speed;
  if (keys['s']) raccoon.y += raccoon.speed;

  raccoon.x = Math.max(0, Math.min(544, raccoon.x));
  raccoon.y = Math.max(0, Math.min(264, raccoon.y));

  raccoonCanvas.style.left = raccoon.x + 'px';
  raccoonCanvas.style.top = raccoon.y + 'px';

  checkCollision();
  requestAnimationFrame(gameLoop);
}

/* === MAPACHE === */
const ctx = raccoonCanvas.getContext('2d');
ctx.imageSmoothingEnabled = false;

const px = 6;
const R = '#ff4d6d';
const D = '#c9184a';
const B = '#000';
const G = '#ffb3c6';

const sprite = [
'....RRRRRR....',
'...RRRRRRRR...',
'..RRDDRRDDRR..',
'.RRDDRRDDRRRR.',
'.RRRRRRRRRRRR.',
'.RRBBRRBBRRRR.',
'..RRRRRRRRRR..',
'..RRRRGGRRRR..',
'...RRRGGRRR...',
'....RRRRRR....'
];

sprite.forEach((row, y) => {
  [...row].forEach((p, x) => {
    let c = null;
    if (p === 'R') c = R;
    if (p === 'D') c = D;
    if (p === 'B') c = B;
    if (p === 'G') c = G;
    if (c) {
      ctx.fillStyle = c;
      ctx.fillRect(x * px, y * px, px, px);
    }
  });
});

resetGame();
gameLoop();
</script>
</body>
</html>


